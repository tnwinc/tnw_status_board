// Generated by CoffeeScript 1.7.1
var warningWords, weatherKey, weatherLoc, weatherUrl;

weatherKey = localStorage.getItem('weatherKey');

weatherLoc = localStorage.getItem('weatherLoc');

warningWords = ["rain", "storm", "thunder", "lightning", "strong", "bad"];

if (!weatherKey) {
  weatherKey = prompt("Enter forecast.io API key:");
  localStorage.setItem('weatherKey', weatherKey);
}

if (!weatherLoc) {
  weatherLoc = prompt("Enter lat/long choordinates (in format lat,long):");
  localStorage.setItem('weatherLoc', weatherLoc);
}

weatherUrl = "https://api.forecast.io/forecast/" + weatherKey + "/" + weatherLoc;

$.ajax(weatherUrl, {
  jsonp: "callback",
  dataType: "jsonp",
  success: (function(_this) {
    return function(response) {
      var hourly, skycons;
      skycons = new Skycons({
        color: "white"
      });
      skycons.add("currentWeatherIcon", response.currently.icon);
      skycons.play();
      $("#currentTemp span").text(Math.round(response.currently.temperature));
      $("#currentDescription").text(response.currently.summary);
      $("#longDescription").text(response.minutely.summary);
      hourly = response.hourly.summary;
      if (warningWords.some(function(word) {
        return ~hourly.toLowerCase().indexOf(word);
      })) {
        return $("#warningsDescription").text(hourly);
      }
    };
  })(this)
});
